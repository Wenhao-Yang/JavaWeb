<!DOCTYPE HTML>
<html lang="en-US">
<head>
	<meta charset="UTF-8">
	
	<title>K-line</title>
	<link rel="stylesheet" href="css/templatemo_misc.css">
	<link rel="stylesheet" href="css/style.css">
   	<link type="text/css" rel="stylesheet" href="css/easy-responsive-tabs.css" />
   	
    <link href="css/templatemo_style.css" rel="stylesheet"> 
    <script type="text/javascript" src="js/echarts.js"></script>   	  	
	<script src="js/jquery-1.10.2.min.js"></script> 
	<div class="logocontainer">
    	<div class="row">
        	<h1><a href="#">Stock</a></h1>
            <div class="clear"></div>
            <div class="templatemo_smalltitle" id="title"></div>
       </div>
       
    </div>
    
      <div id="main" style="width: 1000px;height:500px;top:50px;left:0px;"></div>
      <div id="table" style="width: 300px;height:500px;top:-500px;left:1000px;position: relative;">
      <div class="fshbbox">
        <div class="fshbboxr">
            
            <div class="stiqc">
                <div class="qctit">
                    <ul id="tabview1">
                        <li class="at"  style="color:#FFF;font-size:22px">行 情 报 价</li>
                        
                    </ul>
                </div>
                <div id="qctinfo">
                    <div class="bxaox">
                        <ul>
                            <li><span class="qaa" style="color:#FFF">卖五:</span><span class="qab" id="irba"  style="color:#FFF">--</span><span class="qac" style="color:#FFF">-   成交量：</span><span class="qac" id="irbb"  style="color:#FFF">--</span></li>
                            <li><span class="qaa" style="color:#FFF">卖四:</span><span class="qab" id="irbc"  style="color:#FFF">--</span><span class="qac" style="color:#FFF">-   成交量：</span><span class="qac" id="irbd"  style="color:#FFF">--</span></li>
                            <li><span class="qaa" style="color:#FFF">卖三:</span><span class="qab" id="irbe"  style="color:#FFF">--</span><span class="qac" style="color:#FFF">-   成交量：</span><span class="qac" id="irbf"  style="color:#FFF">--</span></li>
                            <li><span class="qaa" style="color:#FFF">卖二:</span><span class="qab" id="irbg"  style="color:#FFF">--</span><span class="qac" style="color:#FFF">-   成交量：</span><span class="qac" id="irbh"  style="color:#FFF">--</span></li>
                            <li><span class="qaa" style="color:#FFF">卖一:</span><span class="qab" id="irbi"  style="color:#FFF">--</span><span class="qac" style="color:#FFF">-   成交量：</span><span class="qac" id="irbj"  style="color:#FFF">--</span></li>
                        </ul>
                    </div>
                    <div class="bxaox">
                        <ul>
                            <li><span class="qaa"  style="color:#FFF">买一:</span><span class="qab" id="irda"  style="color:#FFF">--</span><span class="qac" style="color:#FFF">-   成交量：</span><span class="qac" id="irdb"  style="color:#FFF">--</span></li>
                            <li><span class="qaa"  style="color:#FFF">买二:</span><span class="qab" id="irdc"  style="color:#FFF">--</span><span class="qac" style="color:#FFF">-   成交量：</span><span class="qac" id="irdd"  style="color:#FFF">--</span></li>
                            <li><span class="qaa"  style="color:#FFF">买三:</span><span class="qab" id="irde"  style="color:#FFF">--</span><span class="qac" style="color:#FFF">-   成交量：</span><span class="qac" id="irdf"  style="color:#FFF">--</span></li>
                            <li><span class="qaa"  style="color:#FFF">买四:</span><span class="qab" id="irdg"  style="color:#FFF">--</span><span class="qac" style="color:#FFF">-   成交量：</span><span class="qac" id="irdh"  style="color:#FFF">--</span></li>
                            <li><span class="qaa"  style="color:#FFF">买五:</span><span class="qab" id="irdi"  style="color:#FFF">--</span><span class="qac" style="color:#FFF">-   成交量：</span><span class="qac" id="irdj"  style="color:#FFF">--</span></li>
                        </ul>
                    </div>
                </div><br></br>
                <div style="display:none" id="myfavor">
                    <div class="bxaox">
                    </div>
                </div>
                <div style="display:none" id="latest">
                    <div class="bxaox">
                    </div>
                </div>
                <div class="bxaox">
                    <ul>
                        <li><span class="qba"   style="color:#FFF">最新：</span><span class="qbb" id="irea"  style="color:#FFF">-</span></li>
                        <li><span class="qbc"  style="color:#FFF">均价：</span><span class="qbd" id="ireb"  style="color:#FFF">-</span></li>
                        <li><span class="qba"   style="color:#FFF">涨跌：</span><span class="qbb" id="irec"  style="color:#FFF">-</span></li>
                        <li><span class="qba"   style="color:#FFF">涨幅：</span><span class="qbb" id="iree"  style="color:#FFF">-</span></li>
                        <li><span class="qbc"  style="color:#FFF">今开：</span><span class="qbd" id="ired"  style="color:#FFF">-</span></li>
                        <li><span class="qbc"  style="color:#FFF">昨收：</span><span class="qbd" id="irej"  style="color:#FFF">-</span></li>
                        
                        <li><span class="qbc"  style="color:#FFF">最高：</span><span class="qbd" id="iref"  style="color:#FFF">-</span></li>
                        
                        <li><span class="qbc"  style="color:#FFF">最低：</span><span class="qbd" id="ireh"  style="color:#FFF">-</span></li>
                        <li><span class="qba"   style="color:#FFF">总手：</span><span class="qbb" id="ireg"  style="color:#FFF">-</span></li>
                        
                        <li><span class="qba"   style="color:#FFF">现手：</span><span class="qbb" id="irei"  style="color:#FFF">-</span></li>
                        
                    </ul>
                </div>
                
            </div>
            
           
        </div>
    </div>
    
    </div>
      <script type="text/javascript">
      var value_i="";
   	var pre_due = 0;
   	var pre_pri = 0;
   	var name = [];
   	var price = [];
   	var ntime = [];
   	var pre_value =[];
   	var now_i = 0;
   	var str0 = ["stitit","stime","stizxj","stizd","stizf"];
   	var str  = ["irba","irbb","irbc","irbd","irbe","irbf","irbg","irbh","irbi","irbj"];
   	var num  = [21,20,23,22,25,24,27,26,29,28];
   	var str1 = ["irda","irdb","irdc","irdd","irde","irdf","irdg","irdh","irdi","irdj"];
   	var num1 = [11,10,13,12,15,14,17,16,19,18];
   	var str2 = ["irea","ireb","irec","ired","iree","iref","ireg","ireh","irei","irej","irek","irel","irem","iren","ireo","irep"];
   	var str_c = ["irba","irbc","irbe","irbg","irbi","irda","irdc","irde","irdg","irdi","irea","irec","iree"];
   	var num_c = [21,23,25,27,29,11,13,15,17,19];
   	var num2 = [];
      function updata()
      {
    	  
    	  $.ajax({
              type: "POST",
              url: "stockt/kinfo1.action",
              data: {sid:'600000',stype:'sh'},
			  dataType: "json",
              success: function(data){
                     //console.log(data);
                    
                 	var z = data[3]-data[1];
					var z_r = (data[3]-data[1])/data[1];
					var value  = [data[0],data[30]+" "+data[31],data[3],z.toFixed(2),((z_r*100).toFixed(2))+ '%'];
					var value1 = [];
					var value2 = [data[3]-pre_pri,z,z_r];
					var value3 = [];
					for(var i = 0;i<10;i++)
					{
						value1.push(data[num_c[i]]);
					}
					value1.push(value2[0]);
					value1.push(value2[1]);
					value1.push(value2[2]);
					//console.log(value1);
					
					//console.log(pre_value);
					for(var i = 0;i<11;i++)
					{
						value3.push(value1[i]);
						value1[i] = value1[i] - pre_value[i];
					}
					value3.push(value1[11]);
					value3.push(value1[12]);
					pre_value = value3;
					//console.log(value1);
					pre_pri = data[3];
					//console.log(value[0]);
					
					for(var i = 0;i<5;i++)
					{
						//document.getElementById(str0[i]).innerHTML=value[i];
					}
					
					for(var i = 0;i<10;i++)
					{
						if(i%2==0)
						{
							document.getElementById(str[i]).innerHTML=data[num[i]];
							document.getElementById(str1[i]).innerHTML=data[num1[i]];
						}else{
							document.getElementById(str[i]).innerHTML=parseInt(data[num[i]]/100);
							document.getElementById(str1[i]).innerHTML=parseInt(data[num1[i]]/100);
						}
						
					}
					document.getElementById(str2[0]).innerHTML=data[3];
					document.getElementById(str2[1]).innerHTML=((data[9]/data[8]).toFixed(3));
					//console.log(z.toFixed(2));
					document.getElementById(str2[2]).innerHTML=(z.toFixed(2));
					//console.log(z_r.toFixed(2));
					document.getElementById(str2[4]).innerHTML=((z_r*100).toFixed(2))+ '%' ;
					document.getElementById(str2[3]).innerHTML=data[1];
					document.getElementById(str2[5]).innerHTML=data[4];
					document.getElementById(str2[6]).innerHTML=parseInt(data[8]/100);
					document.getElementById(str2[7]).innerHTML=data[5];
					
					if(pre_due==0)
					{
						document.getElementById(str2[8]).innerHTML=0;
					}else
					{
						document.getElementById(str2[8]).innerHTML=((data[8]/100)-pre_due).toFixed(2);
					}
					pre_due = data[8]/100;
					document.getElementById(str2[9]).innerHTML=data[2];
					//console.log(str_c);
					for(var i = 0;i<13;i++)
					{
						console.log(str_c[i]);
						if(value1[i]>=0)
						{
							if(value1[i]>0)
							{
								document.getElementById(str_c[i]).style.color ="Red";
							}else{
								document.getElementById(str_c[i]).style.color ="White";
							}
							
						}else
						{
							document.getElementById(str_c[i]).style.color ="Green";
						}
					}
					
					
					now_i++;
                     
              }
          });
      }
      function GetQueryString(name) 
      { 
          var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)","i"); 
          var r = window.location.search.substr(1).match(reg); 
          if (r!=null) 
          	return (r[2]); 
          return null; 
      } 
      
      var code = GetQueryString("code");
	  var s_date = GetQueryString("s_date");
	  var sname = decodeURI(GetQueryString("sname"));
	  setInterval(updata,3000);
	  $('#title').text("股票："+sname+" 股票代码：" +code);
	  //var titleStr="股票："+sname+" 股票代码：" +code;
	  if(s_date.length==10)
	  {
		  var s_date1 = s_date.split("-");
		  s_date = s_date1[0]+s_date1[1]+s_date1[2];
	  }
	  //console.log(s_date);
	  var e_date = GetQueryString("e_date");
	  if(e_date.length==10)
	  {
		  var e_date1 = e_date.split("-");
		  e_date = e_date1[0]+e_date1[1]+e_date1[2];
	  }
	  //console.log(e_date);
      var myChart = echarts.init(document.getElementById('main'));
      
      function calculateMA(dayCount, data) {
    	    var result = [];
    	    for (var i = 0, len = data.length; i < len; i++) {
    	        if (i < dayCount) {
    	            result.push('-');
    	            continue;
    	        }
    	        var sum = 0;
    	        for (var j = 0; j < dayCount; j++) {
    	            sum += data[i - j][1];
    	        }
    	        result.push(sum / dayCount);
    	    }
    	    return result;
    	}
    myChart.title = "test";
    $.ajax({
		  method: "POST",
		  url: "usert/kinfo.action",
		  data: {code:code,start:s_date,end:e_date},
		  dataType: "json",	  
		  success: function(data){

			    var rawData = data.reverse();
			    
		       
			    var dates = rawData.map(function (item) {
			        return item[0];
			    });
			  
			    var data = rawData.map(function (item) {
			        return [+item[6], +item[3], +item[5], +item[3]];
			    });
			    
			    var option = {
			        backgroundColor: '#333333',
			        legend: {
			            data: ['日K', 'MA5', 'MA10', 'MA20', 'MA30'],
			            inactiveColor: '#777',
			            textStyle: {
			                color: '#fff'
			            }
			        },
			        tooltip: {
			            trigger: 'axis',
			            axisPointer: {
			                animation: false,
			                type: 'cross',
			                lineStyle: {
			                    color: '#376df4',
			                    width: 2,
			                    opacity: 1
			                }
			            }
			        },
			        xAxis: {
			            type: 'category',
			            data: dates,
			            axisLine: { lineStyle: { color: '#8392A5' } }
			        },
			        yAxis: {
			            scale: true,
			            axisLine: { lineStyle: { color: '#8392A5' } },
			            splitLine: { show: false }
			        },
			        grid: {
			            bottom: 80
			        },
			        dataZoom: [{
			            textStyle: {
			                color: '#8392A5'
			            },
			            handleIcon: 'M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4v1.3h1.3v-1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z',
			            handleSize: '80%',
			            dataBackground: {
			                areaStyle: {
			                    color: '#8392A5'
			                },
			                lineStyle: {
			                    opacity: 0.8,
			                    color: '#8392A5'
			                }
			            },
			            handleStyle: {
			                color: '#fff',
			                shadowBlur: 3,
			                shadowColor: 'rgba(0, 0, 0, 0.6)',
			                shadowOffsetX: 2,
			                shadowOffsetY: 2
			            }
			        }, {
			            type: 'inside'
			        }],
			        animation: false,
			        series: [
			            {
			                type: 'candlestick',
			                name: '日K',
			                data: data,
			                itemStyle: {
			                    normal: {
			                        color: '#FD1050',
			                        color0: '#0CF49B',
			                        borderColor: '#FD1050',
			                        borderColor0: '#0CF49B'
			                    }
			                }
			            },
			            {
			                name: 'MA5',
			                type: 'line',
			                data: calculateMA(5, data),
			                smooth: true,
			                showSymbol: false,
			                lineStyle: {
			                    normal: {
			                        width: 1
			                    }
			                }
			            },
			            {
			                name: 'MA10',
			                type: 'line',
			                data: calculateMA(10, data),
			                smooth: true,
			                showSymbol: false,
			                lineStyle: {
			                    normal: {
			                        width: 1
			                    }
			                }
			            },
			            {
			                name: 'MA20',
			                type: 'line',
			                data: calculateMA(20, data),
			                smooth: true,
			                showSymbol: false,
			                lineStyle: {
			                    normal: {
			                        width: 1
			                    }
			                }
			            },
			            {
			                name: 'MA30',
			                type: 'line',
			                data: calculateMA(30, data),
			                smooth: true,
			                showSymbol: false,
			                lineStyle: {
			                    normal: {
			                        width: 1
			                    }
			                }
			            }
			        ]
			    };
			    myChart.setOption(option);
		  }
		});
        //日期，open，close，..,..,lowest,highest,..,..
        
        

</script>

</head>

<body>

</body>
</html>